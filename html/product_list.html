<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1,minimum-scale=1, maximum-scale=1, user-scalable=no">

    <link rel="stylesheet" href="../css/utils.css"/>
    <link rel="stylesheet" href="../css/style.css">
    <script src="../js/vue.js"></script>
    <script src="../js/jquery-3.3.1.js" charset="utf-8"></script>
    <title>商品列表</title>
    <style>

    </style>
</head>

<body>
<div class="product-list" id="app">
    <div class="show-img">
        <img src="../img/商品展示大图.png" width="100%" height="100%">
        <div class="show-bottom ">
            <div class=" show-name space-no2">
                <div class="show-img-img">
                    <img src="../img/other/showimg.png" alt="">
                </div>
                <div class="show-img-font">
                    <p class="name">登瀛楼</p>
                    <p class="zuan">
                        <span class="z"></span>
                        <span class="z"></span>
                        <span class="z"></span>
                        <span class="z"></span>
                        <span class="z"></span>
                    </p>
                    <p class="jieshao ">公告：做餐饮我们是认真的，中高端餐饮只有…</p>
                </div>
            </div>
        </div>

    </div>
    <div class="massage">
        <div class="massgge-1">
            <p><span class="sucsse">首</span><span>新用户首次下单立减300元</span></p>
            <p><span>6个活动</span><span>▲</span></p>
        </div>
        <p class="massgge-2"><span class="massgge-2-1">商品</span>    </span><span class="massgge-2-2">评价：9.9分</span></p>
    </div>
    <div class="set-meal">
        <ul>
            <p>套餐</p>
            <li>凉菜凉菜</li>
            <li>热菜</li>
        </ul>
        <div class="set-meal-warp">
            <p class="set-meal-warp-1">套餐</p>
            <ul>
                <li v-for="(item ,index) in products">
                    <img src="../img/other/listbackground.png" alt="" width="70" height="70">
                    <div class="menu-warp1">
                        <p style="font-size:14px;color:#333333;">{{item.pro_name}}</p>
                        <p class="menu"
                           style="max-width:80%; white-space:nowrap;text-overflow:ellipsis;overflow:hidden;">
                            {{item.pro_menu}} </p>
                        <p style="font-size:11px;color:#666;">销量{{item.pro_sales}}</p>
                        <div>
                            <p style="font-size: 12px;display: inline-block;">￥<span
                                    style="font-size: 14px">{{item.pro_pries}}</span></p>
                            <p class="number-car  f-right">
                                <span class="cut" @click="item.pro_num>0?item.pro_num--:'';getIsOk(index)"></span>
                                <span class="l-b"
                                      style="height: 20px;width: 20px;text-align: center;font-size: 14px;line-height: 20px;">{{item.pro_num}}</span>
                                <span class="add " @click="item.pro_num++; getIndex(index)"></span>
                            </p>

                        </div>
                    </div>

                </li>

            </ul>
        </div>
    </div>
    <div class="product-list-footer">
        <div class="footer-l">
            <div class="car l-b">
                <span class=" wam l-b" style="line-height: 19px;">{{GetAllpries.allnum}}</span>
            </div>
            <div class="color-w">
                总计:￥{{GetAllpries.allprise}}
            </div>
        </div>
        <div class="footer-r" style="text-align: center;">还差200起送</div>
    </div>
</div>
<div style="height:50px;"></div>

<script>

    $(function () {

        var vm=new Vue({
            el:"#app",
            data: {
                products: [
                    {
                        'pro_name': '精选米饭套餐',
                        'pro_menu': '精品烤鸭、老城水爆肚、芥末鸭掌',
                        'pro_sales': '18',
                        'pro_pries': 29.01,
                        'pro_num': 0
                    },
                    {
                        'pro_name': '精选米饭套餐',
                        'pro_menu': '精品烤鸭、老城水爆肚、芥末鸭掌',
                        'pro_sales': '18',
                        'pro_pries': 29.01,
                        'pro_num': 0
                    },
                    {
                        'pro_name': '精选米饭套餐',
                        'pro_menu': '精品烤鸭、老城水爆肚、芥末鸭掌',
                        'pro_sales': '0',
                        'pro_pries': 29.00,
                        'pro_num': 0
                    },
                    {
                        'pro_name': '精选米饭套餐',
                        'pro_menu': '精品烤鸭、老城水爆肚、芥末鸭掌',
                        'pro_sales': '18',
                        'pro_pries': 29.01,
                        'pro_num': 0
                    },
                    {
                        'pro_name': '精选米饭套餐',
                        'pro_menu': '精品烤鸭、老城水爆肚、芥末鸭掌',
                        'pro_sales': '18',
                        'pro_pries': 29.01,
                        'pro_num': 0
                    },
                    {
                        'pro_name': '精选米饭套餐',
                        'pro_menu': '精品烤鸭、老城水爆肚、芥末鸭掌',
                        'pro_sales': '0',
                        'pro_pries': 29.00,
                        'pro_num': 0
                    },
                    {
                        'pro_name': '精选米饭套餐',
                        'pro_menu': '精品烤鸭、老城水爆肚、芥末鸭掌',
                        'pro_sales': '18',
                        'pro_pries': 29.01,
                        'pro_num': 0
                    },
                    {
                        'pro_name': '精选米饭套餐',
                        'pro_menu': '精品烤鸭、老城水爆肚、芥末鸭掌',
                        'pro_sales': '18',
                        'pro_pries': 29.01,
                        'pro_num': 0
                    }
                ],
                addCar: []
            },
/*
            computed:{

                GetAllpries:function(){


                    var allprise=0.0;
                    var allnum=0;
                    for(var i=0;i<this.products.length;i++){
                        var prise=(this.products[i].pro_pries*this.products[i].pro_num)
                        prise2=parseInt(prise*10)/10;
                        allprise+=prise2;
                        allnum+=this.products[i].pro_num;
                    }
                    console.log(new Date().getTime())
                    return {allprise:allprise.toFixed(1),allnum:allnum}
                },

            },
*/
            methods: {

                getIndex: function (index) {
                    if (this.addCar[index] == null) {
                        this.addCar.push(index);
                    }
                },
                getIsOk: function (val) {
                    function RemoveValByIndex(arr, index) {
                        arr.splice(index, 1);
                    }
                    if (this.products[val].pro_num == 0) {
                        RemoveValByIndex(this.addCar, val)
                    }
                },

            },
            computed:{
                    GetAllpries: function () {

                        var allprise = 0.0;
                        var allnum = 0;

                        for (var i = 0; i < this.addCar.length; i++) {
                            var index = this.addCar[i];
                            var prise = (this.products[index].pro_pries * this.products[index].pro_num)
                            prise2 = parseInt(prise * 10) / 10;
                            allprise += prise2;
                            allnum += this.products[index].pro_num;
                        }

                        return {allprise: allprise.toFixed(1), allnum: allnum}

                    },
                },
        });


        var span = "<span></span>";
         var carIndex=0;
        $(".add").click(function () {
            carIndex++;
            //获取对象
            var th = $(this);
            th.append(span);
            var p1 = [];
            //【添加购物车
            var x_car = $(".car").offset().left;
            var y_car = $(".car").offset().top;
            p1.push(x_car+30, y_car);
            //存放car位置
            var p2 = [];
            var x = $(this).offset().left;
            var y = $(this).offset().top;
            p2.push(x, y);
            //定义参数
            var Xv, Yv, t, v, a = 5;
            t = Math.sqrt((p1[1] - p2[1]) / a / 2);

            v = (p2[0] - p1[0]) / t;
            var i = 0;
            var T = setInterval(function () {
                Xv = i * v * 0.5;
                Yv = a * i * i * 2 * 0.25;
                i++;
                if (Yv>p1[1] - p2[1]) {
                    clearInterval(T);
                    th.children("span").eq(0).remove();
                  /* console.log(Xv > p2[0] - p1[0])*/
                } else {
                    th.children("span").eq(0).css({
                        background: "#FF0000",
                        transform: "translate(" + -Xv + "px," + Yv + "px)"});
                   /* th.siblings(".l-b").text(carIndex);*/
                   /* $(".product-list-footer .wam").text(carIndex);*/
                }
            }, 30);

        })
    })
</script>

</body>

</html>
